/*
 * @Author: cloudyi.li
 * @Date: 2023-04-05 15:37:14
 * @LastEditTime: 2023-05-08 19:32:34
 * @LastEditors: cloudyi.li
 * @FilePath: /chatserver-api/internal/dao/query/chat_test.go
 */
package query

import (
	"chatserver-api/internal/model"
	"chatserver-api/internal/model/entity"
	"chatserver-api/pkg/config"
	"chatserver-api/pkg/db"
	"chatserver-api/pkg/logger"
	"chatserver-api/pkg/pgvector"
	"context"
	"fmt"
	"testing"
)

func Test_chatDao_ChatRegenRecordGet(t *testing.T) {
	c := config.Load("../../../configs/config.yml")
	logger.InitLogger(&c.LogConfig, c.AppName)
	// confi := config.DBConfig{
	// 	Dbname:   "whatserver",
	// 	Host:     "192.168.10.251",
	// 	Port:     "5432",
	// 	Username: "whatserver",
	// 	Password: "whatserver123",
	// }
	ds := db.NewDefaultPostGre(c.DBConfig)
	defer ds.Close()
	type args struct {
		ctx    context.Context
		chatId int64
		msgid  int64
		memory int16
	}
	tests := []struct {
		name    string
		args    args
		wantr   []model.RecordOne
		wantid  int64
		wantErr bool
	}{
		{
			name: "test1",
			args: args{
				ctx:    context.Background(),
				chatId: 1647868345921310720,
				msgid:  1648535109717987328,
				memory: 5,
			},
			wantr:   []model.RecordOne{},
			wantid:  1648525207868018688,
			wantErr: false,
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			cd := &chatDao{
				ds: ds,
			}
			got, gotid, err := cd.ChatRegenRecordGet(tt.args.ctx, tt.args.chatId, tt.args.msgid, tt.args.memory)
			if (err != nil) != tt.wantErr {
				t.Errorf("chatDao.ChatRegenRecordGet() error = %v, wantErr %v", err, tt.wantErr)
				return
			}
			for i, v := range got {
				fmt.Printf("id:%d,msgid:%d,msg:%s\n", i, v.Id, v.Message)
			}
			fmt.Printf("id:%d\n", gotid)
			// if !reflect.DeepEqual(got, tt.want) {
			// 	t.Errorf("chatDao.ChatRegenRecordGet() = %v, want %v", got, tt.want)
			// }
		})
	}
}

func Test_chatDao_DocEmbeddingSave(t *testing.T) {
	c := config.Load("../../../configs/config.yml")
	logger.InitLogger(&c.LogConfig, c.AppName)
	// confi := config.DBConfig{
	// 	Dbname:   "whatserver",
	// 	Host:     "192.168.10.251",
	// 	Port:     "5432",
	// 	Username: "whatserver",
	// 	Password: "whatserver123",
	// }
	ds := db.NewDefaultPostGre(c.DBConfig)
	defer ds.Close()
	type args struct {
		ctx  context.Context
		docs *entity.Documents
	}
	tests := []struct {
		name    string
		args    args
		wantErr bool
	}{
		// TODO: Add test cases.
		{
			name: "test1",
			args: args{
				ctx: context.Background(),
				// chatId: 1647868345921310720,
				// msgid:  1648535109717987328,
				// memory: 5,
				docs: &entity.Documents{
					Id:        1647868345921310720,
					Title:     "深圳市中新赛克科技股份有限公司2021年年度报告",
					Body:      "（二）公司的主要产品及其用途报告期内公司的主要产品及其用途未发生重大变化。公司产品地图如下，其中蓝色部分为公司主营业务：宽带网产品，用于互联网流量分析领域，对网络层、传送层流量进行原始数据采集、深度检测、分层解析、按需筛选，与其他系统配合可实现对网络运行质量、协议标准、承载业务的监测、统计、管控，实现在网络管理、信息安全等领域的应用。宽带网产品进一步可分为机架式、盒式、加速卡等形态，主要应用于运营商和政企部门。报告期内，公司推出了400G接口单板，并研发推出新一代自主可控的宽带网产品，全面满足了国产化需求。同时，升级优化了宽带网数据转发平台，为宽带网系列产品的模块化和组件化提供软硬件基础平台。根据客户需求，升级优化了5G精细化分流产品，满足运营商多种5G组网模式下的信令解析、流量采集、数据解析和应用感知等数据可视化需求。为进一步提高产品核心竞争力，保持市场领先优势，公司及时全面升级优化了DFX产品。同时，研发面向企业的业务分发平台产品，满足企业数据采集、多业务分发和应用感知等集约化建设需求，为企业侧“智改数转''的网络安全和数据监管保驾护航。公司全程参与国家部委开展的流量可视化分析规范研讨编写工作，响应相关部委分层解耦技术架构演进政策号召，通过规范检测工作并获得测试报告，同时在部委遴选的试点城市进行宽带网产品部署，圆满完成现网流量分析验证测试任务，试点效果获得各试点客户的一致好评，同时也为部委后续修订完善技术规范提供现网验证依据。",
					Tokens:    676,
					Embedding: pgvector.NewVector([]float32{-0.01438847, -0.010247602, 0.006145076, -0.0038515648, -0.009738708, 0.0004661962, -0.022488955, 0.017511548, -0.002856432, -0.04316541, 0.007452168, 0.029223096, -0.002474761, 0.0035430912, -0.018752415, 0.026755305, -0.009006736, -0.011125969, 0.008281736, -0.01281996, -0.01535049, 0.014709144, -0.025472611, -0.001697477, -0.023088476, 0.02449665, 0.013733181, 0.0013210345, -0.007842553, 0.02883271, 0.013349768, 0.0011868397, 0.0043151467, 0.008476928, 0.030505788, 0.0029697134, 0.006343754, -0.009655054, 0.03170483, -0.0054549314, 0.01883607, 0.012290152, 0.0098851025, 0.013384623, 0.01823655, 0.022307705, 0.008658178, 0.00448594, -0.009529573, 0.020481262, -0.010986545, 0.0141165955, -0.014444239, -0.005144715, -0.0009716052, 0.009578371, 0.0021959147, 0.008985823, 0.001763703, -0.040906757, -0.010191834, 0.008386304, -0.036389444, -0.021931263, -0.02847021, -0.00031914833, -0.002507874, 0.010136064, -0.0020826336, 0.0022011432, 0.042022143, 0.03491156, -0.00376094, 0.02106684, 0.0379231, -0.008804573, -0.017344242, -0.021582706, -0.005388705, 0.0070269275, 0.008330534, -0.0038132234, -0.009229814, 0.015712991, 0.03262502, 0.026518285, -0.028302902, 0.02233559, -0.011509382, -0.010847122, -0.008316591, 0.009634141, 0.023938958, 0.005695436, 0.017344242, 0.008023803, -0.012283181, 0.03797887, -0.030226942, -0.02088559, 0.0057512056, -0.01625674, -0.036026943, 0.0024172491, -0.027131747, -0.010087266, -0.0018299291, -0.025416842, 0.023241842, -0.027354825, -0.02516588, 0.017567318, 0.0009001508, 0.00082433945, 0.002037321, -0.007079211, 0.012478373, -0.01601972, 0.021638475, -0.00080516876, -0.0006509319, 0.01607549, 0.019756261, -0.015922125, 0.028275017, -0.0077240434, -0.017915877, -0.018152896, 0.029892325, 0.0062078163, -0.0035622618, 0.006009138, 0.022070687, -0.0024887035, 0.0018944122, -0.0187803, 0.00055115717, 0.011572123, -0.0024189919, -0.03979137, 0.01896155, 0.023492804, -0.012680537, -0.011830055, 0.016577413, 0.023325495, -0.0066365427, 0.017288473, 0.013433422, -0.006469235, 0.015629336, -0.030477904, 0.010150006, 0.019407704, -0.0027065522, 0.0022725975, -0.0010430595, 0.02570963, -0.009048563, 0.015378375, 0.0077031297, 0.03895483, -0.013942316, 0.0033966969, -0.000045421453, 0.029083671, -0.007030413, -0.016772607, 0.008142313, -0.010129093, -0.01794376, 0.01654953, -0.02780098, 0.0017227475, 0.02016059, 0.00704087, -0.003544834, -0.016117318, -0.041994255, -0.006716711, 0.004297719, -0.022739917, 0.016410107, 0.00541659, -0.027410593, -0.00541659, 0.02516588, 0.0014648146, 0.00511683, -0.027229344, 0.0076473607, 0.030226942, 0.0069537302, -0.006964187, -0.5853542, -0.0013829035, 0.020146647, -0.041687526, 0.010742554, -0.01703751, 0.03226252, 0.010742554, -0.0031108793, -0.041854832, -0.0036040887, -0.0038445937, -0.01300121, -0.021443283, -0.016577413, -0.014032941, -0.015643278, 0.02034184, -0.002425963, 0.0136983255, -0.0023980783, 0.017372126, -0.0005868844, 0.011258421, 0.0056780083, 0.01498799, 0.027828863, 0.0017218761, -0.017525492, 0.009425006, -0.017720684, 0.016159145, 0.027312998, 0.006326326, 0.058167342, -0.01185794, -0.02516588, 0.0042663487, 0.0335731, 0.02690867, -0.00087008765, -0.0154899135, 0.0149601055, -0.003494293, -0.014820682, 0.03100771, 0.0187803, 0.0009628912, 0.0067620235, 0.008400246, -0.0020007223, -0.035301946, -0.0026804104, 0.000021063246, -0.0015798387, 0.008372361, 0.01384472, -0.02792646, -0.010540391, 0.0074173124, -0.001904869, 0.030171173, -0.016061548, -0.0141165955, -0.026546171, 0.016898088, -0.037253868, -0.0012208241, 0.034632713, 0.032374058, -0.015740875, 0.025653861, 0.0090415925, -0.018989434, 0.028177422, 0.024942804, 0.029725019, 0.024245689, -0.009236785, 0.01384472, 0.0021000614, -0.009947843, -0.0036563724, -0.010477651, 0.008163226, 0.009536545, -0.01071467, -0.005531614, 0.0118997665, -0.0065807733, 0.004189666, 0.0067689945, -0.0053747627, -0.023743765, -0.005604811, 0.035385597, -0.003882935, 0.007828611, -0.017623087, -0.02081588, -0.018501453, -0.00902765, -0.0040990408, -0.006542432, 0.024887035, 0.021777898, -0.019226454, -0.024900977, 0.020258186, -0.014778855, -0.013572845, -0.005831374, -0.012861786, -0.026030304, -0.015127413, -0.018431742, 0.0060823355, -0.013140633, 0.0063855806, 0.0029871413, 0.011432699, 0.005862744, 0.03652887, -0.012903614, 0.011237507, 0.023646168, 0.013649528, 0.0090415925, -0.007354572, -0.012624768, -0.008156255, -0.015977895, 0.03672406, -0.00033178355, 0.03407502, 0.008435101, 0.03178848, -0.0019658667, -0.025249535, -0.04218945, -0.013942316, -0.0030568528, 0.020244243, -0.015057702, -0.016758664, -0.020634629, -0.008560582, -0.0007868695, -0.003370555, 0.009906015, -0.012987267, -0.02166636, -0.0020338353, 0.023813477, 0.014053855, 0.014290874, 0.04249618, -0.014472124, -0.01613126, 0.004907695, -0.007821639, -0.0022307707, -0.015294721, -0.005852287, 0.0003923455, -0.02618367, 0.014667316, 0.021401456, 0.013259143, -0.01788799, -0.00024050496, -0.002377165, -0.02529136, 0.008358419, -0.022725975, -0.003882935, -0.015392317, -0.012311066, 0.023520688, -0.005158657, 0.0050052917, 0.0254029, -0.029641364, -0.031927906, 0.0115790935, 0.0037574542, 0.018083185, 0.015238952, -0.015991837, 0.0025409872, -0.01714905, 0.036640406, -0.019491358, -0.0020686912, -0.011753373, 0.010247602, 0.003959618, -0.015155298, -0.013349768, 0.01233895, 0.017539434, 0.0014360585, -0.01408174, 0.026267324, 0.008532697, 0.000964634, 0.013440393, 0.0036145456, 0.0379231, 0.00041391252, 0.014151451, -0.026476458, -0.014486067, -0.036668293, -0.020592801, 0.021526936, -0.01788799, 0.017971646, -0.024357226, 0.0046671904, -0.015420202, -0.0018996405, 0.02239136, 0.0038027668, 0.00080821867, 0.005360821, -0.01167669, 0.037449062, 0.019616839, -0.013328854, -0.0049983202, 0.006981615, 0.016981741, 0.009912987, -0.011209622, 0.010310343, 0.028330786, -0.03625002, 0.029752903, -0.018166838, 0.018208666, 0.015308663, 0.021262033, -0.0122134695, 0.021345686, 0.002227285, 0.026100015, 0.01233895, -0.029780788, -0.0045730798, -0.018320203, 0.011321161, -0.017734626, -0.031286556, 0.037170216, -0.012624768, 0.021819726, 0.027522132, 0.025542323, 0.004803128, 0.03588752, 0.0008827229, 0.026741363, -0.0051900274, -0.013321883, -0.0035047499, -0.014597605, -0.013356739, -0.02756396, -0.0066609415, 0.02618367, -0.010240631, 0.028944248, -0.013970201, 0.0090415925, 0.0014892137, 0.020355782, -0.0062496434, -0.010275487, 0.027577901, -0.038006753, -0.014269961, 0.011627892, 0.026434632, -0.0034402665, -0.03527406, -0.013245201, 0.012304094, 0.002443391, 0.015225009, -0.01889184, -0.01101443, -0.0015467257, 0.015615394, -0.015629336, 0.031202903, 0.023213957, -0.013461307, -0.040432718, -0.00659123, -0.009411063, 0.00084002456, -0.02052309, -0.030505788, 0.049801953, -0.005754691, -0.033684637, 0.0052980804, 0.005165628, -0.0019920084, -0.006577288, -0.030171173, -0.018696645, -0.009808419, -0.011307218, -0.0019414675, -0.017079337, 0.0013654756, 0.024733668, -0.011864911, -0.006420437, -0.015824528, -0.013070921, 0.012931499, 0.017218761, 0.022656264, -0.009892073, 0.00015140483, -0.01667501, -0.012680537, -0.037644252, 0.00021959149, 0.027661556, -0.0005193513, -0.0089370245, 0.0053643063, 0.025667803, 0.0006979872, -0.0048554116, 0.013412508, 0.008706977, -0.013426451, 0.00020597594, 0.005315508, -0.013370682, -0.0021331743, 0.007898322, 0.024106264, 0.0021262032, -0.0008304392, -0.0014081739, 0.03346156, 0.008804573, 0.017372126, -0.02039761, -0.0077798124, 0.0044685123, 0.020787993, -0.029948095, 0.021638475, -0.015629336, -0.014151451, 0.0027623214, 0.01997934, 0.009919958, 0.024775496, 0.003652887, -0.04893753, 0.007717072, -0.007570678, -0.0023074534, 0.013105777, -0.011335103, -0.0025148452, 0.01180217, -0.010045439, -0.05604811, -0.002650783, 0.0070234416, -0.00025902208, 0.010930776, -0.01678655, 0.004221036, -0.031286556, -0.0033740406, -0.0069920714, 0.015015875, -0.025960593, 0.0045800507, 0.00015783138, -0.011070199, -0.011823084, -0.018389916, -0.0030010836, -0.017162992, -0.0154899135, -0.005468874, -0.005970797, 0.0339356, 0.013252172, 0.0048135845, 0.014165393, -0.0011415272, 0.036919255, -0.0049390653, 0.0051795705, 0.00075811346, -0.027494248, -0.01480674, -0.0047857002, -0.021485109, -0.029501941, 0.0020390637, -0.004827527, -0.022126457, -0.015378375, 0.017748568, 0.007926207, -0.0032102184, 0.021889437, -0.009724766, -0.010087266, 0.010875007, -0.022600494, -0.013070921, -0.029585594, -0.027075978, -0.015517798, 0.027396651, 0.008874284, 0.005123801, -0.021108666, 0.0003999702, 0.0021540879, 0.020592801, -0.0140120275, -0.008748803, -0.0022255422, -0.0020181502, -0.0073197163, -0.0034908075, 0.032541364, -0.008658178, -0.009850247, 0.022907225, -0.017302414, 0.012387748, 0.013091835, -0.040739447, 0.035971176, 0.002988884, -0.024636073, -0.017748568, 0.009975728, 0.009438948, 0.006361182, 0.01378198, -0.023855302, -0.012464431, 0.0007502709, 0.0055908686, -0.010261545, -0.02034184, -0.014109624, -0.03661252, 0.007333658, 0.030533673, -0.007898322, 0.039568294, -0.025026457, -0.016424049, 0.0034141247, -0.017121164, 0.019449532, -0.024998574, -0.03100771, -0.019407704, -0.0012678794, -0.028010113, -0.031286556, -0.009843275, -0.017121164, 0.020676455, 0.036779832, 0.0121089015, 0.0035430912, 0.004750844, 0.018738473, -0.029418288, -0.014681259, -0.016242798, -0.008525726, -0.030979827, 0.012875729, -0.0038515648, 0.004015387, 0.00073937845, -0.012980296, -0.02076011, 0.026755305, 0.0005184799, -0.0051725996, 0.009139189, -0.03803464, 0.017218761, 0.0007981976, -0.0026891243, 0.015392317, -0.04910484, -0.0009986184, 0.036975022, -0.0032903866, 0.01649376, 0.02335338, 0.03262502, -0.004712503, 0.02594665, 0.011404815, -0.003882935, 0.018794242, -0.0013410766, -0.04057214, -0.0029174297, 0.030533673, 0.0010718156, -0.00038319585, -0.011718517, -0.00016295082, 0.009383179, -0.0032433313, 0.0021959147, -0.011021401, 0.008839428, -0.040042333, -0.0014526151, -0.027480306, -0.015657222, -0.026574055, 0.049021184, 0.014723086, -0.028191363, 0.028972134, -0.001379418, 0.008225966, 0.0113699585, 0.01854328, 0.045061566, -0.018696645, 0.03822983, 0.051781762, -0.017344242, -0.036500983, -0.07054812, -0.020174531, -0.023074534, 0.01823655, 0.04442022, -0.02064857, 0.008002889, 0.01348222, 0.024984632, -0.01535049, -0.024594245, 0.0034298098, 0.009899044, 0.021011071, -0.010296401, -0.019435588, 0.00927164, 0.025333188, -0.017720684, -0.018794242, -0.0017523749, -0.0065040905, -0.0056605805, 0.030003864, -0.017218761, 0.025542323, -0.006096278, -0.015908184, -0.003426324, -0.0068177925, -0.01372621, 0.0015571824, -0.006193874, 0.030868288, -0.006960701, -0.0075358218, 0.010700728, 0.026783189, -0.023227898, -0.0027170088, -0.00812837, 0.046344258, 0.0041304114, -0.011843998, 0.020369723, -0.0038794496, 0.051140416, -0.0078007258, 0.0029906267, -0.036556754, -0.026072131, -0.006511062, 0.007591591, 0.015880298, -0.0035796897, 0.005625725, -0.0034472377, -0.028330786, -0.0025984992, -0.006218273, 0.023743765, 0.00032263392, -0.027285112, 0.013259143, -0.004900724, 0.024524534, 0.00998967, -0.0049739215, -0.005068032, 0.025375016, -0.023381265, 0.011662748, 0.024580304, -0.0040885843, -0.026838958, 0.0060718786, 0.0065738023, -0.006312384, 0.02413415, -0.0036877426, -0.02208463, -0.016465876, 0.0066016866, 0.003196276, -0.0009053792, 0.006667913, 0.044866376, 0.019100973, -0.009299525, 0.0013611186, -0.008421159, -0.022237994, -0.009494717, -0.0030516244, -0.004684618, -0.014242076, 0.01889184, -0.0009419777, -0.009397121, -0.012352892, -0.013231258, -0.042830795, -0.020955302, 0.012680537, 0.0017053195, 0.010888949, -0.017344242, -0.03544137, -0.005458417, -0.015880298, 0.00042088368, 0.009585342, 0.021331744, -0.010505536, -0.014256018, 0.004771758, -0.004057214, -0.024650015, -0.024956746, -0.011711545, -0.03273656, -0.009780535, -0.012736306, 0.035413485, 0.00728486, -0.023757707, -0.013293998, -0.0062635858, -0.034437522, -0.008163226, -0.034800023, 0.02275386, 0.010345199, 0.008769717, 0.0058557726, 0.026685594, -0.0063855806, 0.01643799, -0.0051133446, 0.008267794, 0.02268415, -0.017553376, 0.03273656, -0.01703751, -0.066588506, -0.0077519277, 0.010212746, -0.010644958, 0.0091461595, 0.037337523, -0.006633057, -0.014918278, -0.018877896, 0.019533185, -0.013287027, -0.010219717, 0.001295764, -0.043444257, -0.0068108216, 0.02353463, 0.0052945944, -0.022907225, 0.022419244, 0.0042942334, 0.0004788314, -0.0062147873, -0.021025013, -0.0060126237, 0.005873201, -0.005608297, -0.01095866, 0.014109624, 0.0037539687, 0.045312528, 0.019059146, -0.016005779, 0.0088254865, 0.0020303498, -0.024761554, -0.0050819744, 0.011823084, -0.024092322, 0.014974047, -0.005556013, 0.013050008, -0.0119973635, -0.0202303, -0.008288707, -0.02137357, -0.038201947, 0.00095504866, 0.005015748, -0.006598201, 0.0017654458, -0.002666468, -0.016465876, 0.012241353, -0.004593993, 0.0025862998, -0.0043081758, -0.012206498, 0.015657222, 0.017135106, -0.0077240434, -0.014513951, 0.002253427, -0.028484153, -0.005507215, 0.29423866, 0.021178378, -0.01601972, 0.028149536, -0.0035152065, 0.020927416, 0.014513951, 0.01727453, 0.019784147, 0.027494248, -0.006152047, 0.0005955983, -0.016716838, -0.01620097, 0.016842319, -0.01776251, -0.028721172, -0.010268516, 0.014974047, 0.021931263, 0.0039944737, -0.018696645, -0.014269961, -0.012499287, 0.028149536, -0.005831374, -0.0022359989, -0.017567318, 0.030477904, 0.02966925, -0.024608187, 0.010150006, 0.006531975, 0.009599285, -0.019407704, 0.0021645445, 0.013105777, 0.017051453, 0.019965397, 0.005043633, 0.011404815, -0.014402413, 0.023994727, -0.02925098, 0.027522132, 0.007410341, -0.0031753625, -0.008358419, 0.004224522, 0.011990392, -0.021903379, 0.01535049, -0.0045207962, 0.013558903, -0.010393997, -0.010519478, 0.016661068, 0.010644958, 0.0030010836, -0.000714108, -0.009418035, 0.018097127, -0.022377418, 0.016103376, -0.0030795091, -0.00644135, -0.02239136, -0.0039631035, 0.029390402, 0.0020913475, 0.0041373824, -0.0072500044, -0.014583663, -0.017135106, -0.019491358, -0.014764913, 0.029111557, 0.01402597, 0.032234635, 0.030812519, 0.00824688, 0.006911903, -0.003163163, -0.007452168, 0.0064448356, -0.0030533674, 0.02342309, -0.00818414, -0.0055943546, -0.02516588, -0.023227898, 0.002037321, -0.0054723592, -0.009174044, -0.0034489804, 0.020774052, 0.0098851025, -0.009662026, 0.005688465, -0.015657222, -0.019212512, 0.08515967, 0.019421646, 0.027354825, -0.021833668, 0.0052632242, 0.01113294, 0.018027415, -0.020076936, -0.01883607, 0.013928374, -0.044392336, 0.010156977, -0.023409149, 0.00016589178, -0.0065354607, 0.02425963, 0.0009864189, -0.025612036, -0.0062635858, 0.002891288, -0.04617695, -0.024956746, -0.007312745, -0.024217803, -0.008804573, 0.026866844, 0.010575247, -0.017051453, -0.0187803, 0.01847357, -0.01776251, 0.023311554, -0.02221011, -0.011439671, 0.0031927903, 0.0001615348, -0.014667316, -0.012555056, -0.0019554098, -0.0035640046, 0.020620685, 0.010700728, 0.012652652, 0.02191732, 0.018529339, -0.0058000037, 0.018877896, 0.023325495, -0.010219717, -0.027619729, 0.002012922, 0.008253851, 0.0057407487, 0.019142801, -0.002872117, -0.029083671, -0.019616839, 0.045312528, -0.00097247656, -0.04152022, -0.043249067, 0.030254826, -0.0080935145, 0.0025479584, 0.0024172491, -0.17879626, 0.022419244, 0.021833668, -0.0011641834, 0.014918278, 0.011125969, 0.014834625, -0.005409619, -0.013837749, 0.017734626, 0.018515397, 0.00009939347, -0.015503855, -0.010150006, 0.0018334145, 0.00011949001, -0.0393731, 0.02262838, 0.011460584, 0.005705893, 0.03159329, -0.02696444, -0.013489191, 0.014876451, 0.018905781, 0.008016832, -0.02563992, 0.027257228, -0.017846165, -0.02529136, -0.0070757256, -0.028553864, 0.02703415, -0.00033047647, 0.023590399, 0.0004075949, -0.030533673, -0.011202651, -0.025625978, 0.03694714, 0.013942316, 0.03231829, 0.019310107, 0.01745578, 0.012366834, 0.015336548, 0.0028529465, -0.0038376225, 0.00031239502, -0.013733181, 0.030728865, -0.024900977, 0.016284626, 0.0064274077, 0.0011685403, 0.014653374, -0.015252894, 0.011662748, 0.019128857, 0.0058104605, -0.0122134695, -0.015685106, 0.010122121, -0.00981539, -0.027117806, -0.012792075, -0.031035597, 0.012506258, -0.03323848, 0.01981203, -0.0025619005, 0.00027056807, 0.013029095, -0.012471402, 0.025542323, 0.026476458, -0.011432699, -0.0009106075, 0.016702894, 0.021805782, -0.006664427, 0.002342309, -0.00033679407, -0.0020198931, -0.013991115, -0.0022760832, 0.012394719, 0.009982699, 0.030896174, -0.000722822, 0.022781745, -0.030589443, -0.0003341799, -0.026113959, 0.00091322174, 0.016953856, 0.00559784, -0.009634141, -0.0015388832, 0.0057686334, 0.0036354589, 0.006430893, -0.014890394, 0.01480674, 0.007919236, 0.025570208, 0.018487511, 0.026434632, 0.05772119, -0.0076613026, -0.03215098, 0.017135106, 0.0017950733, -0.0072988025, 0.0184178, 0.015657222, -0.002110518, -0.0050819744, 0.00069188746, -0.012492316, 0.01613126, 0.006246158, 0.001242609, 0.018612992, -0.0139074605, -0.00043417246, -0.07082697, -0.008741832, 0.033126943, 0.023074534, -0.006852648, 0.016828375, 0.0013898746, 0.018905781, 0.0028878022, 0.021401456, -0.037532717, -0.014102653, -0.021485109, -0.007145437, 0.021596648, -0.004221036, -0.0037679109, 0.0041687526, 0.0030254826, 0.033266366, -0.011753373, -0.025416842, 0.00066269573, -0.0071349805, -0.017734626, -0.010156977, -0.03184425, -0.0048240414, 0.0020878618, 0.020955302, 0.008644236, -0.014458182, 0.02137357, -0.0156014515, -0.000012233566, -0.012973325, -0.0107355835, -0.0027640641, 0.04472695, -0.019575013, 0.014862509, 0.015503855, 0.0011127711, -0.026950497, 0.0012853072, -0.020439435, -0.015225009, 0.028609633, -0.01685626, 0.0023057105, -0.010847122, -0.00013125384, -0.02629521, -0.014500009, 0.012297123, -0.0075846203, -0.007835582, 0.010512507, -0.030561557, -0.009529573, -0.025235593, -0.006235701, -0.03661252, 0.025598092, 0.01348222, 0.0072430335, 0.0015990094, 0.008950967, 0.020425493, -0.010679814, -0.013572845, 0.0018334145, -0.016925972, 0.0050471183, -0.035413485, -0.0039456757, -0.012722364, 0.014186307, 0.023506746, -0.013991115, -0.028121652, -0.032792326, -0.0038271658, -0.04177118, 0.024412995, 0.01203919, -0.00004438667, -0.014290874, 0.018571164, -0.028749056, 0.009557458, 0.01047068, 0.01438847, 0.008232938, 0.011767315, -0.0049425513, -0.0038480794, 0.013565874, -0.030673096, 0.023590399, -0.010798324, -0.021945206, -0.09291159, 0.008595438, 0.03376829, 0.019575013, -0.005075003, -0.0039526466, 0.0020268643, -0.010979574, 0.014374528, 0.009599285, -0.02149905, 0.02221011, -0.006615629, -0.017692799, -0.022614436, -0.0184178, 0.016591357, -0.0015231981, 0.024273572, 0.016772607, 0.010366112, -0.0027710353, 0.0075079375, -0.0026838959, 0.00088010874, 0.008818515, -0.029278865, 0.012436546, 0.008421159, -0.04115772, 0.006981615, -0.0053956765, -0.014611548, -0.012771161, -0.021443283, -0.048240416, -0.016465876, 0.031509634, 0.026030304, 0.022949053, -0.005183056, -0.011293276, 0.011300247, -0.019421646, -0.021415398, 0.011892796, -0.00812837, -0.009829333, 0.0173303, -0.010045439, 0.012087989, -0.00023723723, -0.006204331, -0.018334147, -0.001573739, -0.015782703, 0.0058278884, 0.0027309512, 0.0035430912, 0.0047996426, 0.0147509705, 0.022893284, 0.0045730798, -0.020118762, 0.0041304114, -0.008943995, -0.031565405, -0.009278611, -0.014890394, -0.033879828, -0.013879576, -0.016117318, -0.0039631035, 0.0021436312, -0.0068177925, 0.009648083, -0.0034193532, -0.023799533, 0.001946696, 0.018585108, 0.038843293, 0.0056849793, -0.028637517, 0.030059634, -0.010066353, 0.02913944, -0.010428852, 0.0075567355, -0.02552838, 0.007215149, -0.0071733217, 0.0049530077, 0.0039387043, 0.020216359, -0.019059146, 0.016117318, 0.0059498833, 0.0035291489, 0.009857218, 0.021763956, -0.009696881, 0.011272362, -0.00677248, -0.02179184, -0.03262502, 0.02221011, -0.013091835, -0.034576945, -0.02763367, 0.016298568, -0.02076011, -0.0061415904, 0.023743765, 0.017664915, -0.0064796917, 0.015545683, -0.0043744016, -0.0065459176, -0.019128857, 0.008058659, 0.016842319, 0.023548571, -0.013252172, 0.0069084177, 0.01089592, 0.019407704, 0.028888479, -0.011321161, -0.009069476, -0.01763703, -0.0115860645, 0.010505536, 0.0053468784, -0.016563471, -0.011481497, -0.00003060774, -0.003949161, 0.010331256, 0.0021070326, 0.0511683, 0.028093766, -0.004214065, 0.011202651, 0.0026838959, 0.002077405, -0.009696881, -0.010261545, 0.0034385237, -0.025695689, 0.010310343, -0.001527555, -0.003039425, -0.030979827, -0.023590399, 0.019491358, -0.01812501, 0.004851926, -0.04910484, 0.008212024, 0.037225984, -0.03195579, -0.00046793898, 0.0033897257, -0.0379231, 0.0017506321, -0.008163226, 0.005820917, -0.010700728, -0.03984714, -0.0007995047, 0.006685341, -0.0076543316, -0.029808672, 0.026490401, 0.010212746, -0.015266837, -0.012401691, 0.008700006, 0.018515397, 0.00050235906, 0.006608658, -0.024998574, -0.017971646, 0.003163163, 0.001578096, 0.002244713, -0.01727453, -0.00057512056}),
				},
			},
			wantErr: false,
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			cd := &chatDao{
				ds: ds,
			}
			if err := cd.DocEmbeddingSave(tt.args.ctx, tt.args.docs); (err != nil) != tt.wantErr {
				t.Errorf("chatDao.DocEmbeddingSave() error = %v, wantErr %v", err, tt.wantErr)
			}
		})
	}
}

func Test_chatDao_ChatEmbeddingCompare(t *testing.T) {
	c := config.Load("../../../configs/config.yml")
	logger.InitLogger(&c.LogConfig, c.AppName)
	// confi := config.DBConfig{
	// 	Dbname:   "whatserver",
	// 	Host:     "192.168.10.251",
	// 	Port:     "5432",
	// 	Username: "whatserver",
	// 	Password: "whatserver123",
	// }
	ds := db.NewDefaultPostGre(c.DBConfig)
	defer ds.Close()
	type args struct {
		ctx      context.Context
		question pgvector.Vector
	}
	tests := []struct {
		name string
		args args
		// want    []model.DocsCompare
		wantErr bool
	}{
		{
			name: "test1",
			args: args{
				ctx:      context.Background(),
				question: pgvector.NewVector([]float32{-0.006838327, 0.016993335, 0.013385978, -0.025430378, -0.009145098, 0.0144070685, 0.0000043562018, -0.022121148, 0.007397318, -0.030588003, 0.014295271, 0.0024409285, -0.009741355, -0.015212016, -0.007270613, -0.0027017912, 0.018856639, -0.01981065, 0.027487464, -0.014623212, -0.01325182, -0.008012208, 0.010881697, -0.024521085, -0.027815405, 0.010650647, 0.01521947, -0.01730637, 0.0034228899, -0.024133516, 0.048684414, -0.005813509, -0.017917534, -0.003122898, -0.0042595137, 0.0074308575, -0.005008562, 0.0051911655, 0.05008562, -0.0012092845, 0.0025527268, -0.014213285, 0.009555024, 0.016531235, 0.0013881617, 0.012260542, -0.007997302, -0.013259273, -0.009323974, 0.005645812, 0.0013881617, 0.0070693763, 0.0012577304, 0.038548037, 0.0023570799, 0.024983184, -0.023104973, 0.0312737, 0.008586106, -0.022523623, 0.015323814, 0.005057008, -0.0435566, 0.025147155, -0.02073485, 0.02358198, 0.013177288, -0.015189656, 0.03532825, -0.0025993094, 0.008138913, 0.03532825, -0.022672687, 0.003385624, 0.030021558, -0.02926133, -0.022046616, -0.0046843467, 0.015964791, 0.005276878, 0.012655563, -0.0007346077, -0.012260542, 0.02842657, 0.019721212, 0.0077513456, 0.009033299, -0.00065634894, -0.02161433, 0.0042297007, 0.021718675, 0.008951314, 0.046269573, 0.019825557, -0.019050423, 0.02884395, -0.004524103, 0.011619565, -0.015562317, 0.005399856, -0.0080196615, 0.0004909807, -0.053991105, -0.011440688, -0.016426891, 0.009309068, -0.0006381817, 0.010359972, 0.0187672, 0.0068793194, -0.014146206, 0.029171892, -0.019005703, -0.014332537, -0.039770365, -0.0051837126, -0.005861955, 0.008228351, -0.003953932, -0.017947346, 0.0162182, 0.02244909, 0.018469071, 0.0049004904, -0.0099873105, 0.01767903, -0.02390992, 0.008958767, 0.0043340456, -0.013154929, 0.040068496, 0.015502691, 0.011627018, -0.009912779, -0.031810332, 0.031750705, 0.0016182797, -0.021495078, -0.014951154, -0.014198379, 0.012215823, 0.02847129, -0.011567393, -0.0034303432, -0.025221687, 0.024550898, -0.010382331, 0.0064954786, -0.0024390654, 0.0076395473, 0.011619565, -0.045166496, 0.0035123285, 0.015197109, -0.002321677, -0.009800981, -0.013818265, 0.018409446, -0.0077513456, -0.007073103, 0.03106501, 0.018960984, 0.01223073, -0.0063948603, -0.01605423, 0.029693617, 0.022627966, -0.0012139428, 0.026533453, -0.022329839, 0.0007523091, 0.024774494, -0.010643194, -0.00470298, -0.025355844, 0.009316522, 0.013833171, 0.0034918322, -0.0049675694, -0.004572549, -0.015413253, -0.011254358, 0.0077737053, 0.014764823, -0.006920312, 0.009167457, 0.0171424, -0.01730637, -0.0011692235, -0.01881192, 0.0003284074, 0.0045166495, -0.029797962, -0.0111202, -0.5590509, -0.009130191, -0.0013946833, -0.028501103, 0.017783375, 0.0103152525, 0.024148423, -0.0025806765, 0.0030725887, -0.06540944, 0.0012381657, 0.0080196615, -0.002187519, -0.0126704695, -0.00787805, -0.024014266, 0.026652705, -0.03374817, 0.012521405, 0.005444575, 0.004464477, -0.01390025, -0.026682517, -0.022061523, 0.0061451774, 0.005228432, 0.021167137, -0.01130653, -0.01651633, 0.020302564, -0.0149437, 0.0247894, 0.0075501087, -0.0062197098, 0.06660195, 0.00046186656, -0.021032978, 0.02115223, 0.0021148503, 0.047432274, -0.02838185, -0.008325243, 0.018051691, -0.0048520444, -0.0053365035, 0.014854262, 0.011276717, -0.013825717, -0.011343797, 0.003331588, 0.0016052367, -0.02930605, 0.020645412, 0.017470341, -0.005511654, -0.0054594814, 0.009495399, -0.014153659, -0.00044905633, 0.0089065945, 0.0067265285, 0.026980646, -0.02742784, -0.031869955, -0.0298874, -0.0008720264, -0.008735171, 0.0026440287, 0.011500314, 0.009443226, 0.0153536275, -0.015905166, -0.0076171877, 0.015666662, 0.022419278, 0.02650364, 0.013244367, -0.016397078, -0.0021744762, 0.01906533, 0.025937196, 0.013982235, -0.01755978, -0.025340939, 0.014183472, 0.013982235, -0.025877569, -0.018051691, -0.0056495387, -0.016456703, 0.02972343, -0.0031433944, -0.013721373, -0.033241346, 0.018960984, 0.019572148, 0.0013099029, 0.010859338, 0.025743412, -0.020615598, -0.022165868, -0.031661265, 0.005045828, -0.0031322145, 0.031631455, -0.0078258775, -0.020749757, -0.009830793, 0.026280044, 0.013959875, -0.00085339334, -0.016098948, -0.013915156, -0.0030520924, 0.011418329, -0.03273453, 0.007110369, -0.006808514, 0.002498691, -0.0010648784, 0.031124635, -0.0066780825, 0.032794155, 0.011276717, 0.017336182, 0.0056793513, -0.01985537, -0.024029171, 0.0058880416, -0.037951782, 0.008265617, 0.02399936, 0.041946705, -0.013497776, 0.023104973, -0.006063192, 0.02244909, 0.010352518, -0.01433999, -0.014630665, -0.014034408, -0.002155843, 0.014839355, -0.02265778, -0.026682517, -0.010687914, -0.014764823, 0.006201077, -0.005414762, 0.0069650314, -0.008541387, -0.003680026, -0.02395464, 0.022732312, 0.0042856, -0.0081538195, 0.0062793354, -0.01742562, -0.02119695, -0.014287817, 0.014302724, -0.0028210427, -0.0123425275, 0.0028694887, -0.02194227, -0.027532184, 0.0018530561, 0.025490003, -0.027323494, -0.017231839, -0.008422135, -0.00831779, 0.002044045, 0.014638118, -0.020809382, -0.01346051, -0.028352037, -0.023104973, 0.011455595, -0.01132889, 0.012730095, 0.03577544, -0.030886132, -0.008138913, 0.034135733, -0.010538849, 0.012022039, 0.011157466, -0.014213285, 0.021301294, -0.00012297808, 0.03681889, -0.025102435, 0.011694098, 0.014571039, -0.0196914, -0.005899221, 0.037057396, -0.0061936234, -0.00013252752, 0.035059933, 0.010561208, 0.0059364876, -0.029350769, 0.008325243, -0.011738817, -0.014369803, -0.011142559, -0.013915156, -0.010337612, 0.008235805, 0.00061954866, 0.0037582847, -0.008556293, 0.024506178, -0.00036054937, -0.004375038, 0.017828096, -0.000704329, 0.022523623, 0.0041626217, -0.022046616, 0.028545821, -0.009875513, -0.00022895352, -0.00921963, 0.012983504, 0.030021558, 0.01410894, 0.0013099029, -0.013825717, -0.009905325, -0.010248174, -0.007967489, 0.051486824, 0.016546141, 0.01918458, -0.016069137, 0.018379634, 0.0022378284, 0.02374595, 0.010896604, -0.009622104, -0.028113535, 0.004035917, 0.046508074, 0.033092283, 0.019661587, -0.027875032, -0.006886773, -0.028873762, 0.0044793836, 0.01684427, 0.018200757, 0.018513791, -0.0044532972, 0.0076693604, 0.037355524, 0.019780839, 0.010904057, -0.0035104651, -0.0019247934, 0.025817944, -0.0075314757, -0.008645732, -0.022672687, -0.024476364, -0.014250551, 0.022553435, -0.0020570878, 0.018573416, -0.031363137, 0.012059305, -0.019736119, 0.016441796, 0.0030166896, 0.0045352825, -0.0029048913, -0.0017654808, 0.008660639, -0.028903576, -0.011850615, 0.022270212, 0.012610843, 0.010583568, -0.034135733, -0.010598475, 0.02763653, 0.018215662, 0.025445282, -0.019557241, -0.009793527, 0.008996033, -0.011209639, -0.0247894, -0.011224545, 0.030796694, -0.0006209462, -0.016575955, -0.006465666, -0.026309857, 0.008630825, -0.026607985, -0.035626378, 0.036312073, -0.0047663325, -0.030707255, -0.014049314, 0.014354896, -0.01044941, -0.0049936553, -0.030483657, 0.004225974, -0.025162062, -0.005914128, 0.00917491, -0.046597514, -0.006558831, 0.033658728, 0.028396757, -0.020645412, -0.0013248094, -0.023328569, 0.016963523, -0.025340939, 0.0149437, 0.008205992, -0.013780998, 0.008787343, 0.014176019, -0.00181579, -0.013430697, 0.015472879, -0.02550491, 0.026324762, 0.0036483498, -0.007017204, -0.010501583, 0.009838247, 0.0077513456, -0.007982396, -0.028545821, -0.007527749, 0.0020738577, -0.0023477634, 0.001561449, 0.0149660595, 0.0107400855, 0.02490865, 0.025803037, 0.010233267, 0.0012903382, 0.037176646, -0.014347443, 0.005902948, 0.004874404, 0.013453057, 0.01834982, -0.006767521, 0.01195496, -0.041499514, 0.0029682438, 0.017321277, 0.0068606865, 0.014019501, 0.030036464, 0.019840464, -0.00083382864, 0.023328569, -0.0065774643, -0.005209799, 0.008414682, -0.020362189, -0.008705358, 0.01985537, -0.0032868688, -0.024446553, -0.002847129, -0.006957578, -0.015144937, -0.001840013, -0.026265137, -0.01199968, -0.02010878, 0.0065811905, -0.007319059, 0.020019341, -0.001705855, -0.019288925, 0.0037079756, -0.005284331, -0.036401514, 0.0030166896, -0.0055899126, -0.005463208, -0.007360052, -0.020034248, -0.00001130356, -0.013952422, 0.012081665, 0.010650647, -0.0046508075, 0.014831902, 0.015964791, -0.021390732, -0.00004209903, -0.0010071159, -0.019616866, 0.0008324312, -0.024282582, -0.010188548, 0.0023477634, -0.016113855, -0.003991198, 0.002914208, -0.03377798, 0.03356929, -0.0034079836, 0.008407229, -0.010941323, 0.024297487, 0.015577224, 0.021823019, -0.026637798, -0.016665393, -0.0110680275, -0.023418007, -0.012461779, 0.012864253, -0.005276878, -0.0041812547, 0.004341499, 0.0052582445, -0.038607664, 0.011597206, 0.005828416, -0.02291119, 0.014272911, 0.023731044, 0.017798282, -0.016874084, 0.024342207, -0.042602587, 0.011381063, 0.02742784, -0.02984268, 0.024610523, 0.01216365, -0.015502691, 0.011835708, -0.012431966, -0.021599423, 0.0021260302, 0.02098826, -0.025907382, 0.0075165695, -0.0017030601, -0.009607197, -0.041916892, -0.04209577, 0.018916264, -0.00004617501, -0.0039092125, -0.026518546, -0.005083094, -0.009465585, 0.00007109671, -0.012707735, 0.03971074, -0.02115223, -0.019914996, 0.002670115, -0.0002313991, -0.008235805, 0.009063112, -0.009338881, -0.026607985, -0.010523942, -0.028456382, -0.00682342, -0.00014708457, 0.009994764, 0.02203171, 0.023552166, 0.0025881296, -0.010829524, -0.0054706614, 0.012923879, 0.01026308, 0.0017468478, 0.0036036305, 0.015308908, -0.02446146, -0.0008496668, 0.00003991547, -0.0047663325, 0.01047177, -0.013110209, 0.0098457, 0.028098628, -0.017291464, 0.003189977, -0.014034408, -0.06445542, 0.0081091, -0.001194378, -0.0119326, 0.0027409205, -0.032168087, -0.03172089, 0.0059066745, 0.016501423, 0.036431324, -0.005895495, -0.0029719702, -0.023492541, 0.031661265, 0.015651755, 0.030737067, 0.009182364, 0.0063240547, -0.011254358, -0.0124394195, 0.016903896, 0.030409126, 0.030245155, -0.013400884, 0.011477955, 0.011813349, 0.013147475, 0.026444014, -0.0010611517, -0.023343476, -0.004039644, -0.02089882, -0.008727717, 0.004721613, -0.007520296, 0.02156961, 0.0071737217, -0.026190605, 0.02156961, -0.020228032, 0.016605768, 0.0073637785, -0.00076162565, 0.004825958, -0.014302724, -0.0017021284, 0.05226196, -0.0012959281, 0.0025378205, -0.065767184, 0.023298757, -0.004457024, 0.01788772, 0.057628274, -0.019154768, -0.00213721, 0.01860323, -0.0061265444, -0.0002606297, -0.02145036, 0.033330787, 0.0044123046, 0.04779003, -0.0071737217, -0.02608626, -0.014861715, 0.039323173, -0.013676654, -0.004423484, -0.012178557, -0.010710273, -0.012908972, 0.03836916, 0.01726165, 0.04114176, -0.015398347, 0.007374958, 0.0024707415, 0.004110449, -0.019244207, 0.005463208, -0.018170943, 0.04716396, -0.015077858, -0.0032607825, 0.01890136, 0.006115365, -0.01709768, -0.0053253234, -0.007591102, 0.04594163, -0.016188387, 0.0027427839, 0.014928794, 0.01028544, 0.028068816, 0.0038570398, 0.0049153967, -0.0015567907, -0.00790041, 0.005865682, 0.017276557, 0.02395464, 0.0008496668, 0.0041290824, -0.01262575, -0.0029030282, -0.017246744, 0.011746271, 0.006599824, -0.026563266, -0.014026955, -0.007915316, -0.009763714, 0.019408178, 0.007848238, -0.011299077, -0.004978749, 0.033181723, -0.026116073, 0.037057396, 0.025340939, 0.015577224, -0.022508716, 0.0030632722, -0.010710273, -0.013214554, 0.035924505, -0.0162182, -0.02370123, -0.036848705, 0.0146008525, 0.012595937, 0.03043894, 0.015294001, 0.034642555, 0.010754992, 0.002455835, -0.010986042, -0.021465266, -0.0030912217, -0.021137323, 0.00982334, 0.0014962333, -0.0456435, 0.020824289, -0.025877569, 0.017008241, -0.0019639228, -0.034165546, -0.03347985, -0.027308587, 0.0026347123, 0.0025024177, -0.016620673, -0.01132889, -0.010009671, -0.0315122, -0.004442117, 0.0183051, 0.0010863064, 0.008191085, 0.011925147, -0.022627966, 0.0064582126, -0.018364727, -0.034374237, -0.019288925, -0.015279095, -0.027517278, 0.00034913665, -0.0052023456, 0.021673955, 0.015100217, -0.048416097, -0.026116073, -0.000811469, -0.04439136, -0.006674356, -0.0015353627, 0.016024416, -0.0097562615, -0.010754992, 0.011738817, 0.020585785, -0.009629557, 0.0012055578, 0.010956229, 0.014019501, -0.038309537, -0.00025946513, 0.004811052, 0.0045949086, -0.03201902, 0.0010304073, 0.0030800418, 0.01693371, -0.0014934384, 0.038220096, 0.026309857, 0.0020775842, 0.008996033, 0.009681729, 0.01893117, -0.01068046, 0.008265617, -0.04415286, 0.0110307615, 0.046001256, -0.0055601, -0.003972565, 0.01688899, 0.014071674, 0.0016369128, 0.009212176, -0.022300025, -0.0006437716, 0.0162182, -0.02261306, 0.0040620035, -0.019050423, -0.008444495, 0.034016483, 0.010538849, -0.017410716, -0.005399856, 0.018752294, -0.033122096, 0.010091656, -0.005064461, -0.034046296, 0.0034135734, -0.0035589112, 0.0114928605, 0.010986042, -0.010345065, -0.014332537, -0.016173482, -0.03055819, 0.017917534, -0.0027222876, -0.03658039, -0.010695366, 0.010136375, -0.01132889, 0.009271802, 0.023880107, 0.0009470244, -0.0033204083, -0.002480058, -0.0027893665, 0.00342848, -0.028024096, -0.018618137, 0.009413413, 0.02390992, 0.011284171, 0.29598215, -0.01306549, -0.006976211, 0.028277505, -0.0017924987, -0.010069297, 0.021241669, 0.0192293, -0.002817316, 0.021897553, 0.0022695046, -0.0033092285, -0.02328385, -0.007840784, 0.031214073, -0.021167137, -0.029499833, -0.011671738, -0.038190283, -0.015189656, 0.013631934, 0.016113855, -0.0055526467, -0.0068793194, -0.003931572, -0.0268763, -0.0048296847, -0.013699013, 0.017336182, 0.016337452, -0.026771955, -0.0075053894, 0.023716137, -0.00013345917, -0.0024875111, -0.0002099711, 0.023254037, 0.015785914, 0.0020608145, 0.01475737, -0.004073183, -0.0077066263, -0.013795905, 0.013266726, -0.0052880575, -0.012663016, -0.007915316, -0.012849346, -0.0009344471, 0.043914355, -0.0335991, -0.016784646, 0.005243338, 0.0017785239, -0.018111318, -0.010971135, 0.006890499, 0.0085786525, 0.009294162, 0.0149437, 0.013072942, 0.022508716, 0.01223073, 0.005694258, -0.016173482, 0.0051837126, -0.019288925, 0.0031937035, 0.012640656, -0.0016909486, 0.0029440208, -0.012737548, -0.011440688, 0.00040410412, -0.030051371, -0.0273384, 0.024208048, 0.00073181273, 0.02462543, 0.04418267, 0.019467803, 0.012618297, 0.023388196, 0.008891688, -0.012521405, -0.05488549, 0.018528698, -0.0013033813, -0.020600691, -0.00061209546, 0.031154448, 0.01237234, -0.0038309535, -0.011150013, -0.0038831262, -0.0036054938, 0.013952422, 0.008183632, -0.009323974, -0.0014263594, -0.036103383, 0.059387233, -0.0012353708, -0.00081053737, -0.01538344, -0.02847129, -0.009711542, 0.0020589512, 0.0076134615, -0.010210907, 0.015040592, -0.05831397, 0.023760855, 0.0022415551, -0.007863144, -0.012320167, 0.0112618115, -0.026339669, 0.014280364, -0.014444334, 0.0303495, -0.011880428, 0.01772375, 0.017231839, -0.008556293, -0.00076395477, -0.036252446, 0.0075836484, -0.00079609675, -0.049668238, 0.025266405, -0.0025601801, 0.011902788, -0.0023868927, -0.011843162, -0.020496348, -0.0066296365, -0.0043377723, -0.024357114, 0.016292732, 0.0019993256, -0.0135574015, 0.031124635, -0.0068755927, 0.0019136135, -0.01600951, -0.0014384709, 0.01304313, 0.043407537, -0.010382331, -0.0045464626, 0.0009307205, -0.001344374, -0.022061523, 0.011515221, -0.023835389, -0.030677442, -0.03184014, 0.00427442, 0.010844431, -0.042572778, -0.008846968, 0.014190925, -0.014928794, -0.019005703, -0.023298757, -0.19426066, -0.016605768, 0.039263546, -0.010971135, 0.0019751026, 0.007319059, 0.011448141, -0.0023738497, -0.020332376, 0.008191085, -0.010613381, -0.010859338, -0.037772905, -0.025385657, 0.0126704695, 0.01521947, 0.0074308575, -0.0011748134, 0.02235965, -0.006838327, 0.017082773, -0.026935926, 0.017843002, 0.023775762, 0.012260542, 0.002530367, -0.009696635, 0.02089882, -0.0054594814, -0.025773225, -0.027904844, -0.018990798, 0.0315122, -0.0039837444, 0.007442037, -0.008526481, -0.0040321904, 0.013795905, -0.0061563575, 0.02984268, 0.008205992, 0.0016807005, 0.0058433223, 0.014436881, 0.0009903462, -0.00028718179, -0.010017124, -0.0070805564, -0.0016285279, 0.018364727, -0.0038570398, -0.0050197416, 0.01281208, 0.0037396518, 0.03160164, -0.032883592, 0.010695366, 0.016248014, -0.0045166495, -0.011008401, -0.0064283996, -0.012133838, 0.018752294, -0.008601013, -0.0076470007, -0.013378524, 0.003771328, -0.02173358, -0.0070209303, 0.027666342, -0.0157561, -0.002597446, 0.0162182, 0.013892797, 0.013862983, 0.013549949, 0.0045501892, 0.0009297888, 0.00079097267, 0.02370123, -0.011820802, 0.021644142, -0.028039003, 0.022136055, -0.0049563893, 0.019751025, 0.014138753, -0.0021316202, 0.00894386, -0.0023682597, 0.022523623, -0.04063494, -0.008302884, 0.011075481, 0.01893117, 0.020377096, 0.010583568, -0.014533773, 0.013259273, -0.007848238, -0.0033651276, 0.005016015, -0.020183312, 0.004371312, 0.031869955, 0.018722482, -0.016367264, 0.029335862, 0.04009831, -0.017604498, -0.015711382, 0.0046806205, 0.014816996, 0.024938464, -0.0032570558, 0.022777032, 0.007341419, -0.0029421574, 0.011887881, -0.006674356, -0.010240721, -0.019318739, -0.037564214, 0.0129984105, -0.00940596, -0.048296846, -0.061026942, -0.0222404, 0.027353307, 0.009107831, -0.009189817, 0.024729773, 0.0052992376, 0.0092345355, -0.034761805, 0.020883914, -0.030528378, -0.009241989, -0.0062383427, -0.009994764, 0.02295591, 0.0012241909, 0.006018473, 0.008608466, 0.018111318, 0.038935605, 0.006055739, -0.020183312, 0.021256575, -0.0053924024, 0.003018553, -0.0003700988, -0.023134787, 0.010784805, 0.02537075, -0.0067936075, 0.0366102, -0.007788612, 0.0045278296, -0.023507446, -0.008422135, -0.0018670309, 0.00043741066, -0.012454325, 0.0031694805, -0.037564214, -0.009830793, -0.0064023137, 0.0345233, -0.012267996, -0.018543605, -0.011075481, -0.017202025, 0.043526787, -0.00094236614, -0.011284171, -0.04066475, 0.015472879, -0.02541547, -0.02295591, 0.037146833, -0.024342207, 0.008608466, -0.011053121, -0.009055659, 0.01890136, -0.01600951, -0.008429589, -0.02295591, 0.026175698, 0.026652705, -0.0008846037, 0.014958607, -0.00061582203, -0.011187279, -0.00025108026, -0.040605128, 0.013602121, -0.010106563, 0.02282175, -0.05062225, -0.01647161, -0.016113855, -0.012916425, 0.030707255, -0.003722882, -0.019736119, -0.0187672, 0.0033390413, -0.039651114, 0.0017915671, 0.019736119, 0.02094354, 0.0021782026, 0.023805575, -0.041916892, 0.0005198619, 0.018588323, -0.004110449, -0.012685375, -0.0009288572, 0.0045017432, -0.009420866, 0.0037191552, 0.011947507, 0.03479162, -0.0071550882, -0.02244909, -0.08669582, 0.0020067787, -0.000108246335, 0.0053253234, 0.006100458, -0.017932441, 0.016143668, -0.012431966, -0.008168726, -0.007937676, -0.025907382, -0.011634472, -0.005314144, -0.01890136, -0.0054669348, -0.018528698, 0.0012903382, -0.013549949, 0.00919727, 0.021107512, 0.037713278, 0.00039269138, -0.006599824, 0.00032747572, -0.01797716, -0.013467963, -0.00027483737, 0.021673955, -0.014898981, -0.02249381, 0.0029235245, -0.025996821, -0.0044123046, -0.0064470326, -0.009241989, -0.0070209303, -0.015815727, -0.00078538276, 0.016098948, 0.029529646, -0.033509664, -0.009800981, -0.0149437, -0.010762446, -0.0022769577, -0.0062085297, -0.031035196, 0.029961932, -0.004110449, -0.041410074, 0.027517278, 0.014258005, -0.0050495546, -0.04853535, -0.022180773, -0.029604178, -0.01559213, 0.010225814, 0.0110680275, -0.026563266, 0.001328536, 0.022136055, -0.0034806523, -0.022970814, 0.016292732, 0.00068336684, 0.008228351, -0.010747539, 0.018797014, -0.028769419, -0.013125115, 0.012297808, 0.021435453, 0.01592007, -0.03097557, 0.026160792, -0.008012208, -0.005321597, -0.006886773, 0.021688862, -0.0012474823, -0.042960342, -0.018454166, 0.01042705, 0.036967956, 0.024401832, 0.0005380291, 0.024446553, -0.017023148, 0.0005235885, -0.0150629515, -0.0011179826, -0.0032365595, 0.012267996, -0.013922609, 0.043914355, -0.0032440128, 0.014116393, 0.0022490083, 0.009167457, 0.018126223, 0.0029961932, -0.0007304153, -0.03523881, -0.033450037, 0.011850615, -0.020973353, -0.020242937, 0.0027427839, 0.010665554, -0.020347282, 0.021241669, -0.018096412, 0.0243273, 0.015092765, -0.0009363104, 0.0043191393, -0.007121549, -0.030230248, 0.02842657, 0.023686323, 0.018215662, 0.010784805, 0.006886773, 0.028039003, 0.011194732, 0.006007293, -0.031691078, -0.008526481, 0.0027222876, -0.011358703, -0.029276237, -0.015003326, -0.02775578, -0.023895014, -0.026101166, -0.0005841459, 0.021599423, 0.0071849013, 0.09581856, 0.032168087, -0.010628288, 0.0094283195, 0.002651482, -0.0030353228, 0.008027115, 0.0050346483, -0.028694887, -0.03628226, 0.010300346, -0.01994481, -0.00028485263, -0.014839355, -0.024282582, 0.007989849, -0.0065103853, 0.0014375392, -0.0046880734, 0.0051911655, 0.01839454, 0.0017226248, -0.0038980325, 0.0062234364, -0.03511956, 0.015413253, 0.019974621, 0.010904057, 0.013870437, -0.017440528, 0.019408178, 0.014265457, -0.024610523, -0.017485248, -0.009704089, 0.010635741, -0.017529966, 0.0112618115, 0.032853782, 0.02997684, 0.004855771, 0.011381063, -0.015666662, -0.02537075, 0.005235885, -0.00048585658, -0.008563747, -0.0055153808, -0.0074196775}),
			},
		},
		// TODO: Add test cases.
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			cd := &chatDao{
				ds: ds,
			}
			got, err := cd.ChatEmbeddingCompare(tt.args.ctx, tt.args.question)
			if (err != nil) != tt.wantErr {
				t.Errorf("chatDao.ChatEmbeddingCompare() error = %v, wantErr %v", err, tt.wantErr)
				return
			}
			for _, v := range got {
				fmt.Println(v.Body)
			}
			// if !reflect.DeepEqual(got, tt.want) {
			// 	t.Errorf("chatDao.ChatEmbeddingCompare() = %v, want %v", got, tt.want)
			// }
		})
	}
}

func Test_chatDao_ChatDetailGet(t *testing.T) {
	c := config.Load("../../../configs/config.yml")
	logger.InitLogger(&c.LogConfig, c.AppName)
	// confi := config.DBConfig{
	// 	Dbname:   "whatserver",
	// 	Host:     "192.168.10.251",
	// 	Port:     "5432",
	// 	Username: "whatserver",
	// 	Password: "whatserver123",
	// }
	ds := db.NewDefaultPostGre(c.DBConfig)
	defer ds.Close()
	type args struct {
		ctx    context.Context
		userId int64
		chatId int64
	}
	tests := []struct {
		name    string
		args    args
		wantErr bool
	}{
		// TODO: Add test cases.
		{
			name: "test1",
			args: args{
				ctx:    context.Background(),
				userId: 1646361620252733440,
				chatId: 1654779495221039104,
			},
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			cd := &chatDao{
				ds: ds,
			}
			got, err := cd.ChatDetailGet(tt.args.ctx, tt.args.userId, tt.args.chatId)
			if (err != nil) != tt.wantErr {
				t.Errorf("chatDao.ChatDetailGet() error = %v, wantErr %v", err, tt.wantErr)
				return
			}
			fmt.Println(got.PresetName, "\n", got.PresetContent)
		})
	}
}
